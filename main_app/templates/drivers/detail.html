{% extends 'base.html' %}
{% load static %}
{% block content %}
<section class="driver-card" style="margin-bottom:2em;">
  <div class="card" style="max-width:500px;">
    <div class="card-content card-flex">
      <div class="card-img-container">
        {% if driver.helmets.first and driver.helmets.first.image %}
          <img src="{{ driver.helmets.first.image.url }}" alt="{{ driver.helmets.first.name }}" style="max-width:100px; max-height:100px;" />
        {% else %}
          <img src="{% static 'images/Helmet-icon.png' %}" alt="No helmet image" style="max-width:100px;" />
        {% endif %}
      </div>
      <div class="card-text">
        <h2 class="card-title">{{ driver.name }}</h2>
        <p>Age {{ driver.age }} â€” racing for <strong>{{ driver.current_team }}</strong></p>
        <p><em>{{ driver.drive_years }}</em></p>
        <p><small>{{ driver.description }}</small></p>
        <div style="margin-top:1em;">
          <a href="{% url 'driver-update' driver.id %}" class="btn" style="background:#e10600; color:#fff; padding:0.4em 1em; border-radius:6px; margin-right:0.5em; text-decoration:none;">Edit</a>
          <a href="{% url 'driver-delete' driver.id %}" class="btn" style="background:#6c3483; color:#fff; padding:0.4em 1em; border-radius:6px; text-decoration:none;">Delete</a>
        </div>
      </div>
    </div>
  </div>
</section>
<section class="helmets">
  <div class="subsection-title">
    <h2>Helmets</h2>
  </div>

<!-- Driver's helmets -->
<h3>{{ driver.name }}{% if driver.name|slice:'-1' == 's' %}'{% else %}'s{% endif %} Helmets</h3>
<div class="subsection-content">
  {% if driver.helmets.all %}
    {% for helmet in driver.helmets.all %}
      <div class="item">
        <span class="swatch" style="background: {{ helmet.color }}"></span>
        <a href="{% url 'helmet-detail' helmet.id %}">
          {{ helmet.color }} {{ helmet.name }}
        </a>
        {% if helmet.image %}
          <img src="{{ helmet.image.url }}" alt="{{ helmet.name }}" style="max-width:120px; max-height:120px; display:block; margin:10px 0;" />
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <p>{{ driver.name }} has no helmets yet.</p>
  {% endif %}
</div>

<!-- Results section -->
<section class="results">
  <div class="subsection-title">
    <h2>All Results</h2>
  </div>
  <div class="subsection-content">
    {% if driver.result_set.all %}
  {% for session_code, session_name in session_choices %}
        <h3 style="margin-top:1.5em;">{{ session_name }} Results</h3>
        {% with results=driver.result_set.all|dictsort:"date" %}
        <ul style="padding-left: 1.2em;">
          {% for result in results %}
            {% if result.session == session_code %}
              <li style="margin-bottom:1em;">
                <strong>Date:</strong> {{ result.date }}<br>
                <strong>Session:</strong> {{ result.get_session_display }}<br>
                <strong>Position:</strong> P{{ result.position }}<br>
                <strong>Track:</strong> {{ result.track.name }} ({{ result.track.country }}, {{ result.track.length_km }} km)
              </li>
            {% endif %}
          {% endfor %}
        </ul>
        {% endwith %}
      {% endfor %}
    {% else %}
      <p>No results yet.</p>
    {% endif %}
  </div>
</section>

<!-- Available helmets -->
<!-- Helmet management is only available when editing the driver. -->
</div>
</section>
{% endblock %}